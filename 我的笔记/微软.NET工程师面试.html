
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
<!-- 此处省略掉markdown的css样式，因为太长了 -->
</style>
<h2>微软.NET工程师面试</h2>
<p>设计一个日期类,计算两个日期之间的天数间隔,并考虑跳过部分日期的情况.
``` cs
using System;
using System.Collections.Generic;
using System.Linq;</p>
<p>class MyDate
{
    private int year;
    private int month;
    private int date;
    private bool isLeap;</p>
<pre><code>private int index = 0;

public static List&amp;lt;MyDate&amp;gt; SkipDates = null;

private static bool isLeapYear(int year)
{
    if(year%4!=0)return false;
    if(year%100!=0)return true;
    if(year%400!=0)return false;
    return true;
}

private void calcIndex()
{
    this.index = 0;

    for(int y=0;y&amp;lt;year;y++)
    {
        if(isLeapYear(y))
        {
            this.index+=366;
        }
        else
        {
            this.index+=365;
        }
    }

    int[] monthDays = new int[]{31,this.isLeap ? 29:28,31,30,31,30,31,31,30,31,30,31};

    int m = month-1;
    this.index += this.date;
    while(m&amp;gt;0)
    {
        m--;
        this.index += monthDays[m];
    }
}

private void checkDate()
{
    if(year&amp;lt;=0 || year&amp;gt;9999)
    {
        throw new Exception("Invalid Date");
    }
    if(month&amp;lt;=0 || month&amp;gt;=13)
    {
        throw new Exception("Invalid Date");
    }
    if(date&amp;lt;=0)
    {
        throw new Exception("Invalid Date");
    }

    if(month==1 || month == 3 || month == 5 || month == 7 || month == 8 || month == 10 || month == 12)
    {
        if(date&amp;gt;=32)
        {
            throw new Exception("Invalid Date");
        }
    }
    else if(month != 2)
    {
        if(date&amp;gt;=31)
        {
            throw new Exception("Invalid Date");
        }
    }
    else
    {
        if(this.isLeap)
        {
            if(date&amp;gt;=30)
            {
                throw new Exception("Invalid Date");
            }
        }
        else
        {
            if(date&amp;gt;=29)
            {
                throw new Exception("Invalid Date");
            }
        }
    }
}

public MyDate(int year, int month, int date)
{
    this.isLeap = isLeapYear(year);

    this.year = year;
    this.month = month;
    this.date = date;

    checkDate();

    calcIndex();
}

private bool isBetweenTwoNumbers(MyDate firstDate, MyDate secondDate)
{
    if(firstDate == null || secondDate == null)
    return false;
return (firstDate.index - this.index) * (secondDate.index - this.index)&amp;lt;=0;
}

public static int operator-(MyDate firstDate, MyDate secondDate)
{
    if(firstDate == null || secondDate == null)
        return 0;
    int result = firstDate.index - secondDate.index;
    if(SkipDates == null || SkipDates.Count == 0)
        return result;
    int skip = SkipDates.Where(d=&amp;gt;d.isBetweenTwoNumbers(firstDate,secondDate)).Count();
    skip = result &amp;gt; 0 ? skip : -skip;
    return result - skip;
}
</code></pre>
<p>}</p>
<p>public class Test
{
    public static void Main()
    {
        MyDate.SkipDates = new List&lt;MyDate&gt;{new MyDate(2017,6,5),new MyDate(2017,6,1)};
            MyDate firstDate = new MyDate(2017,7,1);
        MyDate secondDate = new MyDate(2017,6,2);
        Console.WriteLine(firstDate-secondDate);
    }
}
```</p>