<html>

<head>
    <title>微软.NET工程师面试
    </title>
    <style>
        .div_content {
            font-family: "微软雅黑";
            width: 60%;
            margin-left: 20%;
        }
        
        .h1-title {
            text-align: center;
        }
        
        .article_content {
            color: #333;
            font-size: 14px;
            padding: 10px;
        }
    </style>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
</head>

<body>
    <div class="div_content">
        <h1 class="h1-title">
            微软.NET工程师面试
        </h1>
        <div id="article_content" class="article_content">
            <p>&nbsp; &nbsp; 设计一个日期类，计算两个日期之间的天数间隔，并考虑跳过部分日期的情况。
            </p>
<pre><code class="cs">
using System;
using System.Collections.Generic;
using System.Linq;

class MyDate
{
    private int year;
    private int month;
    private int date;
    private bool isLeap;
    
    private int index = 0;
    
    public static List<MyDate> SkipDates = null;
    
    private static bool isLeapYear(int year)
    {
        if(year%4!=0)return false;
        if(year%100!=0)return true;
        if(year%400!=0)return false;
        return true;
    }
    
    private void calcIndex()
    {
        this.index = 0;
        
        for(int y=0;y<year;y++)
        {
            if(isLeapYear(y))
            {
                this.index+=366;
            }
            else
            {
                this.index+=365;
            }
        }
        
        int[] monthDays = new int[]{31,this.isLeap ? 29:28,31,30,31,30,31,31,30,31,30,31};
        
        int m = month-1;
        this.index += this.date;
        while(m>0)
        {
            m--;
            this.index += monthDays[m];
        }
    }
    
    private void checkDate()
    {
        if(year<=0 || year>9999)
        {
            throw new Exception("Invalid Date");
        }
        if(month<=0 || month>=13)
        {
            throw new Exception("Invalid Date");
        }
        if(date<=0)
        {
            throw new Exception("Invalid Date");
        }
        
        if(month==1 || month == 3 || month == 5 || month == 7 || month == 8 || month == 10 || month == 12)
        {
            if(date>=32)
            {
                throw new Exception("Invalid Date");
            }
        }
        else if(month != 2)
        {
            if(date>=31)
            {
                throw new Exception("Invalid Date");
            }
        }
        else
        {
            if(this.isLeap)
            {
                if(date>=30)
                {
                    throw new Exception("Invalid Date");
                }
            }
            else
            {
                if(date>=29)
                {
                    throw new Exception("Invalid Date");
                }
            }
        }
    }
    
    public MyDate(int year, int month, int date)
    {
        this.isLeap = isLeapYear(year);
        
        this.year = year;
        this.month = month;
        this.date = date;
     
        checkDate();
        
        calcIndex();
    }
	
    private static bool isBetweenTwoNumbers(int firstNumber, int secondNumber, int testNumber)
    {
	return (firstNumber - testNumber) * (secondNumber  testNumber)<=0;
    }
    
    public static int operator-(MyDate firstDate, MyDate secondDate)
    {
        if(firstDate == null || secondDate == null)
            return 0;
        int result = firstDate.index - secondDate.index;
        if(SkipDates == null || SkipDates.Count == 0)
            return result;
        int skip = SkipDates.Where(d=>isBetweenTwoNumbers(firstDate.index,secondDate.index,d.index)).Count();
        skip = result > 0 ? skip : -skip;
        return result - skip;
    }
}
 
public class Test
{
	public static void Main()
	{
	    MyDate.SkipDates = new List<MyDate>{new MyDate(2017,6,5),new MyDate(2017,6,1)};
      	    MyDate firstDate = new MyDate(2017,7,1);
	    MyDate secondDate = new MyDate(2017,6,2);
	    Console.WriteLine(firstDate-secondDate);
	}
}

</code></pre>
        </div>
    </div>
    <script>hljs.initHighlightingOnLoad();</script>
</body>

</html>
